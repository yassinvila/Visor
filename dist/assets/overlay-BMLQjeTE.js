import{j as n,r as d,L as I,c as O}from"./loadingSpinner-Ba4fKjup.js";const $=({variant:t="primary",className:s="",...a})=>{const c=["visor-button",t==="ghost"?"visor-button--ghost":"visor-button--primary",s].filter(Boolean).join(" ");return n.jsx("button",{className:c,...a})};function R(t){const s=Math.max(t.width,t.height)*1.4,a=t.x+t.width/2-s/2,c=t.y+t.height/2-s/2;return{left:`${a}px`,top:`${c}px`,width:`${s}px`,height:`${s}px`,borderRadius:`${s}px`}}const T={width:1920,height:1080};function V(){return typeof window>"u"?T:{width:window.innerWidth,height:window.innerHeight}}function p(t,s){return Math.min(Math.max(t,0),s)}function E(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function X(t,s=t){const a=V(),c=E(s),l=E(t),h=Math.max(Math.abs(l.y-c.y),120),u={x:p((c.x+l.x)/2,a.width),y:p(Math.min(c.y,l.y)-h,a.height)},x=p(c.x,a.width),m=p(c.y,a.height),w=p(l.x,a.width),e=p(l.y,a.height);return`M ${x} ${m} Q ${u.x} ${u.y} ${w} ${e}`}function K(t){let c=t.x+t.width+16,l=t.y-80/2+t.height/2;return c+220>window.innerWidth&&(c=t.x-220-16),l+80>window.innerHeight&&(l=window.innerHeight-80-24),l<24&&(l=24),{left:`${c}px`,top:`${l}px`,width:"220px",height:"80px"}}function Y(t){const s={left:`${t.target.x}px`,top:`${t.target.y}px`,width:`${t.target.width}px`,height:`${t.target.height}px`};return t.annotation==="circle"?{type:t.annotation,boxStyle:R(t.target)}:t.annotation==="arrow"?{type:t.annotation,boxStyle:s,arrowPath:X(t.target)}:t.annotation==="tooltip"?{type:t.annotation,boxStyle:s,tooltipPosition:K(t.target)}:{type:"circle",boxStyle:s}}const _=[{id:"step-1",title:"Open Settings",description:"Click the gear icon to open the settings drawer.",actionHint:"Look for the small gear on the top right.",annotation:"circle",target:{x:1180,y:40,width:48,height:48}},{id:"step-2",title:"Enable Feature",description:'Toggle on "Guided Mode".',actionHint:"The switch will turn blue when active.",annotation:"arrow",target:{x:1050,y:220,width:180,height:50}}],F=()=>{var A;const[t,s]=d.useState([]),[a,c]=d.useState(0),[l,h]=d.useState("idle"),[u,x]=d.useState(!1),[m,w]=d.useState(!1),e=typeof window<"u"?(A=window.visor)==null?void 0:A.overlay:void 0,r=t[a],L=r?Y(r):void 0,N=!!r&&l!=="idle";d.useEffect(()=>{t.length===0&&(s(_),h("guiding"))},[t.length]),d.useEffect(()=>{var f,S,M;if(!e)return;(f=e.ready)==null||f.call(e);const i=(S=e.onStepUpdate)==null?void 0:S.call(e,v=>{s(b=>{const C=b.findIndex(g=>g.id===v.id);if(C>=0){const g=[...b];return g[C]=v,g}return[...b,v]}),w(!1),h("guiding")}),o=(M=e.onReset)==null?void 0:M.call(e,()=>{s([]),c(0),h("idle")});return()=>{i==null||i(),o==null||o()}},[e]);const j=d.useCallback(()=>{var i;h(o=>o==="guiding"?"paused":"guiding"),(i=e==null?void 0:e.toggle)==null||i.call(e)},[e]),k=d.useCallback(i=>{var o;(o=e==null?void 0:e.setPointerMode)==null||o.call(e,i)},[e]),y=d.useCallback(()=>{var i;r&&(w(!0),(i=e==null?void 0:e.markDone)==null||i.call(e,r.id),c(o=>{const f=o+1;return f>=t.length?(h("idle"),w(!1),o):f}))},[r,e,t.length]);d.useEffect(()=>{const i=o=>{if(!(!o.metaKey||!o.shiftKey))switch(o.key.toLowerCase()){case"o":o.preventDefault(),j();break;case"d":o.preventDefault(),y();break}};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[j,y]);const P=()=>{c(i=>Math.max(i-1,0))},W=()=>{var o;const i=!u;x(i),(o=e==null?void 0:e.setAutoAdvance)==null||o.call(e,i)},D=d.useMemo(()=>t.map((i,o)=>({...i,status:o<a?"done":o===a?"active":"pending"})),[t,a]);return n.jsxs("div",{className:`overlay-shell status-${l}`,children:[n.jsx(G,{config:L,isActive:l==="guiding"}),n.jsxs("aside",{className:"overlay-panel",onMouseEnter:()=>k("interactive"),onMouseLeave:()=>k("passthrough"),children:[n.jsxs("header",{className:"overlay-panel__header",children:[n.jsxs("div",{children:[n.jsx("p",{className:"panel-label",children:"Visor Guidance"}),n.jsx("h1",{className:"panel-title",children:(r==null?void 0:r.title)??"Waiting for task"})]}),n.jsxs("div",{className:"panel-shortcuts",children:[n.jsx("span",{children:"⌘⇧O Pause/Resume"}),n.jsx("span",{children:"⌘⇧D Done"})]})]}),!N&&n.jsx("div",{className:"panel-empty",children:m?n.jsx(I,{label:"Waiting for next instruction"}):n.jsx("p",{children:"No active guidance. Trigger a task to begin."})}),N&&r&&n.jsxs("div",{className:"panel-body",children:[n.jsx("p",{className:"step-description",children:r.description}),n.jsx("p",{className:"step-hint",children:r.actionHint}),n.jsxs("div",{className:"panel-controls",children:[n.jsx($,{variant:"ghost",onClick:P,disabled:a===0,children:"Back"}),n.jsx($,{variant:"ghost",onClick:j,children:l==="guiding"?"Pause":"Resume"}),n.jsx($,{onClick:y,disabled:m,children:u?"Auto moving…":"Done"})]}),n.jsxs("label",{className:"auto-advance",children:[n.jsx("input",{type:"checkbox",checked:u,onChange:W}),"Allow auto-advance when clicks are detected"]})]}),n.jsx("section",{className:"panel-timeline",children:D.map(i=>n.jsxs("article",{className:`timeline-step timeline-${i.status}`,children:[n.jsx("div",{className:"timeline-marker"}),n.jsxs("div",{children:[n.jsx("p",{className:"timeline-title",children:i.title}),n.jsx("p",{className:"timeline-description",children:i.description})]})]},i.id))})]})]})},G=({config:t,isActive:s})=>{const a=typeof window<"u"?window.innerWidth:1920,c=typeof window<"u"?window.innerHeight:1080;if(!t)return n.jsx("div",{className:"annotation-layer"});const{boxStyle:l,type:h,arrowPath:u,tooltipPosition:x}=t;return n.jsxs("div",{className:`annotation-layer ${s?"active":"paused"}`,children:[n.jsx("div",{className:`annotation-target annotation-${h}`,style:l}),h==="arrow"&&u&&n.jsx("svg",{className:"annotation-arrow",viewBox:`0 0 ${a} ${c}`,children:n.jsx("path",{d:u})}),h==="tooltip"&&x&&n.jsx("div",{className:"annotation-tooltip",style:x,children:"Action here"})]})},H=document.getElementById("root");if(!H)throw new Error("Overlay root element not found");const U=O(H);U.render(n.jsx(F,{}));
