import{r as h,j as e,L as D,V as N,c as I}from"./loadingSpinner-YBlTTw5d.js";function O(t){const o=Math.max(t.width,t.height)*1.4,c=t.x+t.width/2-o/2,l=t.y+t.height/2-o/2;return{left:`${c}px`,top:`${l}px`,width:`${o}px`,height:`${o}px`,borderRadius:`${o}px`}}const V={width:1920,height:1080};function R(){return typeof window>"u"?V:{width:window.innerWidth,height:window.innerHeight}}function p(t,o){return Math.min(Math.max(t,0),o)}function C(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function T(t,o=t){const c=R(),l=C(o),a=C(t),r=Math.max(Math.abs(a.y-l.y),120),u={x:p((l.x+a.x)/2,c.width),y:p(Math.min(l.y,a.y)-r,c.height)},x=p(l.x,c.width),g=p(l.y,c.height),w=p(a.x,c.width),n=p(a.y,c.height);return`M ${x} ${g} Q ${u.x} ${u.y} ${w} ${n}`}function X(t){let l=t.x+t.width+16,a=t.y-80/2+t.height/2;return l+220>window.innerWidth&&(l=t.x-220-16),a+80>window.innerHeight&&(a=window.innerHeight-80-24),a<24&&(a=24),{left:`${l}px`,top:`${a}px`,width:"220px",height:"80px"}}function K(t){const o={left:`${t.target.x}px`,top:`${t.target.y}px`,width:`${t.target.width}px`,height:`${t.target.height}px`};return t.annotation==="circle"?{type:t.annotation,boxStyle:O(t.target)}:t.annotation==="arrow"?{type:t.annotation,boxStyle:o,arrowPath:T(t.target)}:t.annotation==="tooltip"?{type:t.annotation,boxStyle:o,tooltipPosition:X(t.target)}:{type:"circle",boxStyle:o}}const Y=[{id:"step-1",title:"Open Settings",description:"Click the gear icon to open the settings drawer.",actionHint:"Look for the small gear on the top right.",annotation:"circle",target:{x:1180,y:40,width:48,height:48}},{id:"step-2",title:"Enable Feature",description:'Toggle on "Guided Mode".',actionHint:"The switch will turn blue when active.",annotation:"arrow",target:{x:1050,y:220,width:180,height:50}}],_=()=>{var b;const[t,o]=h.useState([]),[c,l]=h.useState(0),[a,r]=h.useState("idle"),[u,x]=h.useState(!1),[g,w]=h.useState(!1),n=typeof window<"u"?(b=window.visor)==null?void 0:b.overlay:void 0,d=t[c],W=d?K(d):void 0,k=!!d&&a!=="idle";h.useEffect(()=>{t.length===0&&(o(Y),r("guiding"))},[t.length]),h.useEffect(()=>{var f,A,S;if(!n)return;(f=n.ready)==null||f.call(n);const i=(A=n.onStepUpdate)==null?void 0:A.call(n,v=>{o($=>{const H=$.findIndex(m=>m.id===v.id);if(H>=0){const m=[...$];return m[H]=v,m}return[...$,v]}),w(!1),r("guiding")}),s=(S=n.onReset)==null?void 0:S.call(n,()=>{o([]),l(0),r("idle")});return()=>{i==null||i(),s==null||s()}},[n]);const y=h.useCallback(()=>{var i;r(s=>s==="guiding"?"paused":"guiding"),(i=n==null?void 0:n.toggle)==null||i.call(n)},[n]),j=h.useCallback(()=>{var i;d&&(w(!0),(i=n==null?void 0:n.markDone)==null||i.call(n,d.id),l(s=>{const f=s+1;return f>=t.length?(r("idle"),w(!1),s):f}))},[d,n,t.length]);h.useEffect(()=>{const i=s=>{if(!(!s.metaKey||!s.shiftKey))switch(s.key.toLowerCase()){case"o":s.preventDefault(),y();break;case"d":s.preventDefault(),j();break}};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[y,j]);const L=()=>{l(i=>Math.max(i-1,0))},M=()=>{var s;const i=!u;x(i),(s=n==null?void 0:n.setAutoAdvance)==null||s.call(n,i)},P=h.useMemo(()=>t.map((i,s)=>({...i,status:s<c?"done":s===c?"active":"pending"})),[t,c]);return e.jsxs("div",{className:`overlay-shell status-${a}`,children:[e.jsx(F,{config:W,isActive:a==="guiding"}),e.jsxs("aside",{className:"overlay-panel",children:[e.jsxs("header",{className:"overlay-panel__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"panel-label",children:"Visor Guidance"}),e.jsx("h1",{className:"panel-title",children:(d==null?void 0:d.title)??"Waiting for task"})]}),e.jsxs("div",{className:"panel-shortcuts",children:[e.jsx("span",{children:"⌘⇧O Pause/Resume"}),e.jsx("span",{children:"⌘⇧D Done"})]})]}),!k&&e.jsx("div",{className:"panel-empty",children:g?e.jsx(D,{label:"Waiting for next instruction"}):e.jsx("p",{children:"No active guidance. Trigger a task to begin."})}),k&&d&&e.jsxs("div",{className:"panel-body",children:[e.jsx("p",{className:"step-description",children:d.description}),e.jsx("p",{className:"step-hint",children:d.actionHint}),e.jsxs("div",{className:"panel-controls",children:[e.jsx(N,{variant:"ghost",onClick:L,disabled:c===0,children:"Back"}),e.jsx(N,{variant:"ghost",onClick:y,children:a==="guiding"?"Pause":"Resume"}),e.jsx(N,{onClick:j,disabled:g,children:u?"Auto moving…":"Done"})]}),e.jsxs("label",{className:"auto-advance",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:M}),"Allow auto-advance when clicks are detected"]})]}),e.jsx("section",{className:"panel-timeline",children:P.map(i=>e.jsxs("article",{className:`timeline-step timeline-${i.status}`,children:[e.jsx("div",{className:"timeline-marker"}),e.jsxs("div",{children:[e.jsx("p",{className:"timeline-title",children:i.title}),e.jsx("p",{className:"timeline-description",children:i.description})]})]},i.id))})]})]})},F=({config:t,isActive:o})=>{const c=typeof window<"u"?window.innerWidth:1920,l=typeof window<"u"?window.innerHeight:1080;if(!t)return e.jsx("div",{className:"annotation-layer"});const{boxStyle:a,type:r,arrowPath:u,tooltipPosition:x}=t;return e.jsxs("div",{className:`annotation-layer ${o?"active":"paused"}`,children:[e.jsx("div",{className:`annotation-target annotation-${r}`,style:a}),r==="arrow"&&u&&e.jsx("svg",{className:"annotation-arrow",viewBox:`0 0 ${c} ${l}`,children:e.jsx("path",{d:u})}),r==="tooltip"&&x&&e.jsx("div",{className:"annotation-tooltip",style:x,children:"Action here"})]})},E=document.getElementById("root");if(!E)throw new Error("Overlay root element not found");const G=I(E);G.render(e.jsx(_,{}));
