import{j as s,r as c,c as Y}from"./index-D6HAasR3.js";const A=({variant:e="primary",className:t="",loading:n=!1,disabled:i,children:o,...d})=>{const a=["visor-button",e==="ghost"?"visor-button--ghost":"visor-button--primary",n?"visor-button--loading":"",t].filter(Boolean).join(" ");return s.jsx("button",{className:a,disabled:i||n,...d,children:n?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"visor-button-spinner"}),s.jsx("span",{style:{opacity:.7},children:"Loading..."})]}):o})};function C(e){const t=Math.max(e.width,e.height)*1.5,n=e.x+e.width/2-t/2,i=e.y+e.height/2-t/2;return{left:`${n}px`,top:`${i}px`,width:`${t}px`,height:`${t}px`,borderRadius:`${t}px`,border:"1.5px solid rgba(255, 255, 255, 0.92)",boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.22) inset, 0 10px 26px rgba(0, 0, 0, 0.28)",background:"transparent"}}const I={width:1920,height:1080};function H(){return typeof window>"u"?I:{width:window.innerWidth,height:window.innerHeight}}function j(e,t){return Math.min(Math.max(e,0),t)}function L(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function D(e,t=e){const n=H(),i=L(t),o=L(e),d=Math.max(Math.abs(o.y-i.y),120),a={x:j((i.x+o.x)/2,n.width),y:j(Math.min(i.y,o.y)-d,n.height)},v=j(i.x,n.width),w=j(i.y,n.height),f=j(o.x,n.width),p=j(o.y,n.height);return`M ${v} ${w} Q ${a.x} ${a.y} ${f} ${p}`}function V(e,t){const n={left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`};return e==="circle"?{type:e,boxStyle:C(t)}:e==="arrow"?{type:e,boxStyle:n,arrowPath:D(t)}:{type:"box",boxStyle:{...n,borderRadius:"14px",border:"1.5px solid rgba(255, 255, 255, 0.92)",boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.22) inset, 0 10px 26px rgba(0, 0, 0, 0.28)",background:"transparent"}}}const z=({instruction:e,viewportWidth:t,viewportHeight:n})=>{const i=c.useMemo(()=>O(e,t,n),[e,t,n]);if(!e||!i)return null;const o=V(e.shape,i),d=U(i,t,n);return s.jsxs("div",{className:"annotation-layer",children:[o.type==="box"&&s.jsx("div",{className:"annotation-box",style:o.boxStyle}),o.type==="circle"&&s.jsx("div",{className:"annotation-circle",style:o.boxStyle}),o.type==="arrow"&&o.arrowPath&&s.jsx("svg",{className:"annotation-arrow",viewBox:`0 0 ${t} ${n}`,preserveAspectRatio:"xMidYMid meet",children:s.jsx("path",{d:o.arrowPath})}),s.jsx("div",{className:"annotation-label",style:d,children:e.label})]})};function O(e,t,n){if(!e)return null;const i=t||(typeof window<"u"?window.innerWidth:1920),o=n||(typeof window<"u"?window.innerHeight:1080),d=e.viewport?.width??i,a=e.viewport?.height??o,v=d?i/d:1,w=a?o/a:1,f=e.bboxPixels?{x:e.bboxPixels.x,y:e.bboxPixels.y,width:e.bboxPixels.width,height:e.bboxPixels.height}:e.bbox?{x:e.bbox.x*d,y:e.bbox.y*a,width:e.bbox.width*d,height:e.bbox.height*a}:null;return f?T({x:f.x*v,y:f.y*w,width:f.width*v,height:f.height*w},i,o):null}function T(e,t,n){const i=Math.min(e.width,t),o=Math.min(e.height,n);return{x:Math.min(Math.max(e.x,0),Math.max(0,t-i)),y:Math.min(Math.max(e.y,0),Math.max(0,n-o)),width:Math.max(1,i),height:Math.max(1,o)}}function U(e,t,n){const o=Math.max(0,t-220),d=Math.min(Math.max(e.x,0),o),a=Math.min(e.y+e.height+12,Math.max(0,n-60));return{left:`${d}px`,top:`${a}px`}}const _={width:typeof window<"u"?window.innerWidth:1920,height:typeof window<"u"?window.innerHeight:1080},F=()=>{const[e,t]=c.useState([]),[n,i]=c.useState(0),[o,d]=c.useState(!1),[a,v]=c.useState(_),[w,f]=c.useState(()=>{const r=typeof window<"u"?window.innerWidth:1920,u=320,h=32;return{x:Math.max(0,r-u-h),y:h}}),[p,E]=c.useState(!1),y=c.useRef(null),S=c.useRef(null),l=typeof window<"u"?window.visor?.overlay:void 0,m=e[n]??null,P=c.useMemo(()=>e.slice(n),[e,n]);c.useEffect(()=>{if(typeof window>"u")return;const r=()=>{v({width:window.innerWidth,height:window.innerHeight}),f(u=>{const h=S.current,g=h?h.offsetWidth:320,b=h?h.offsetHeight:200,x=Math.max(0,window.innerWidth-g-8),M=Math.max(0,window.innerHeight-b-8);return{x:Math.max(0,Math.min(u.x,x)),y:Math.max(0,Math.min(u.y,M))}})};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),c.useEffect(()=>{if(!l)return;l.ready?.();const r=l.onStepUpdate?.(h=>{d(!1),t(g=>{const b=g.findIndex($=>$.id===h.id);let x,M;return b>=0?(x=[...g],x[b]=h,M=b):(x=[...g,h],M=x.length-1),i(M),x})}),u=l.onReset?.(()=>{t([]),i(0),d(!1)});return()=>{r?.(),u?.()}},[l]);const R=c.useCallback(()=>{m&&(d(!0),l?.markDone?.(m.id))},[m,l]),N=c.useCallback(r=>{l?.setPointerMode?.(r)},[l]),k=c.useCallback(r=>{E(!0),y.current={mouseX:r.clientX,mouseY:r.clientY,x:w.x,y:w.y},l?.setPointerMode?.("interactive")},[w,l]);return c.useEffect(()=>{const r=h=>{if(!p||!y.current)return;const g=h.clientX-y.current.mouseX,b=h.clientY-y.current.mouseY,x=S.current,M=x?x.offsetWidth:320,$=x?x.offsetHeight:200,W=Math.max(0,(typeof window<"u"?window.innerWidth:a.width)-M-8),X=Math.max(0,(typeof window<"u"?window.innerHeight:a.height)-$-8);f({x:Math.max(0,Math.min(W,y.current.x+g)),y:Math.max(0,Math.min(X,y.current.y+b))})},u=()=>{E(!1),y.current=null,l?.setPointerMode?.("passthrough")};return p&&(window.addEventListener("mousemove",r),window.addEventListener("mouseup",u,{once:!0})),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",u)}},[p,l,a.height,a.width]),s.jsxs("div",{className:"overlay-shell",children:[s.jsx(z,{instruction:m,viewportWidth:a.width,viewportHeight:a.height}),s.jsxs("section",{ref:r=>{S.current=r},className:`overlay-card ${p?"overlay-card-dragging":""}`,style:{position:"absolute",left:`${w.x}px`,top:`${w.y}px`,cursor:p?"grabbing":"grab"},onMouseEnter:()=>N("interactive"),onMouseLeave:()=>!p&&N("passthrough"),onMouseDown:k,children:[s.jsx("p",{className:"overlay-label",children:m?"Next step":"Waiting for instructions"}),s.jsx("h1",{className:"overlay-title",children:m?.label??"No instruction yet"}),s.jsx("p",{className:"overlay-text",children:m?.step_description??"Trigger a task from the chat window to get started."}),P.length>0&&s.jsx("ol",{className:"overlay-step-list",children:P.map((r,u)=>s.jsxs("li",{className:u===0?"overlay-step-active":"",children:[s.jsx("strong",{children:r.label}),s.jsx("span",{children:r.step_description})]},r.id))}),s.jsx(A,{onClick:R,disabled:!m,loading:o,children:"Mark done"})]})]})},B=document.getElementById("root");if(!B)throw new Error("Overlay root element not found");const Q=Y.createRoot(B);Q.render(s.jsx(F,{}));
