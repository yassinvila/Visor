import{r as a,j as e,c as N}from"./index-D6HAasR3.js";const k=({messages:r,isTyping:n})=>{const t=a.useRef(null),o=()=>{t.current?.scrollIntoView({behavior:"smooth"})};return a.useEffect(()=>{o()},[r,n]),e.jsxs("div",{className:"message-list",children:[r.map(c=>e.jsx("div",{className:`message ${c.role}`,children:e.jsx("div",{className:"message-bubble",children:e.jsx("div",{className:"message-text",children:c.content})})},c.id)),n&&e.jsx("div",{className:"message assistant",children:e.jsx("div",{className:"message-bubble",children:e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})})}),e.jsx("div",{ref:t})]})},y=a.forwardRef(({label:r,ariaLabel:n,className:t,onActivate:o},c)=>e.jsx("button",{type:"button",ref:c,className:t??"pill-header","aria-label":n||r,onClick:o,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),o())},children:e.jsx("span",{className:"pill-label",children:r})}));y.displayName="PillHeader";const R=[{id:"c1",role:"assistant",content:"Hi! What workflow should we tackle?",timestamp:new Date}],C=()=>{const[r,n]=a.useState(R),[t,o]=a.useState(!1),[c,i]=a.useState(!1),[m,f]=a.useState(""),d=a.useRef(null),p=a.useRef(null),u=a.useRef(null),E=()=>{o(!0),u.current?.focus(),d.current?.setAttribute("aria-expanded","true")},h=()=>{o(!1),p.current?.focus(),d.current?.setAttribute("aria-expanded","false")},b=()=>{t?h():E()},x=s=>{t&&d.current&&!d.current.contains(s.target)&&h()};a.useEffect(()=>{document.addEventListener("mousedown",x);const s=l=>{l.key==="Escape"&&t&&(l.preventDefault(),h())};return window.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",x),window.removeEventListener("keydown",s)}},[t]),a.useEffect(()=>{(async()=>{try{await window?.visor?.chat?.clearHistory?.()}catch{}})(),n([])},[]),a.useEffect(()=>{t&&requestAnimationFrame(()=>u.current?.focus())},[t]);const w=()=>{const s=m.trim();if(!s)return;const l={id:`u_${Date.now()}`,role:"user",content:s,timestamp:new Date};n(v=>[...v,l]),f("");try{window?.visor?.chat?.sendMessage?.(s)}catch{}i(!0),window.setTimeout(()=>i(!1),2e3),requestAnimationFrame(()=>u.current?.focus())},g=async()=>{try{const s=await window?.visor?.chat?.clearHistory?.();n([])}catch{}};return e.jsx("div",{id:"chat-root",ref:d,className:`chat ${t?"expanded":"compact"}`,"aria-expanded":t,children:e.jsxs("div",{className:"pill-container",children:[e.jsx(y,{ref:p,className:"pill-header",ariaLabel:"Chat with VISOR",label:"Ask VISOR...",onActivate:b}),t&&e.jsx("div",{className:"pill-toolbar",children:e.jsx("button",{className:"clear-history",onClick:g,title:"Clear chat history",children:"Clear"})}),e.jsx("section",{className:"messages","aria-live":"polite",hidden:!t,children:e.jsx(k,{messages:r,isTyping:c})}),t&&e.jsxs("div",{className:"composer",children:[e.jsx("textarea",{ref:u,className:"composer-input",placeholder:"Ask VISOR...","aria-label":"Chat input",rows:1,value:m,onChange:s=>f(s.target.value),onKeyDown:s=>{const l=(s.ctrlKey||s.metaKey)&&s.key==="Enter";(s.key==="Enter"&&!s.shiftKey||l)&&(s.preventDefault(),w())},autoFocus:!0}),e.jsx("button",{className:"send-button",onClick:w,disabled:!m.trim(),children:"Send"})]})]})})},j=document.getElementById("root");if(!j)throw new Error("Chat root element not found");const D=N.createRoot(j);D.render(e.jsx(C,{}));
