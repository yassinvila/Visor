import{j as r,r as c,c as $}from"./index-D6HAasR3.js";const S=({variant:e="primary",className:t="",...n})=>{const i=["visor-button",e==="ghost"?"visor-button--ghost":"visor-button--primary",t].filter(Boolean).join(" ");return r.jsx("button",{className:i,...n})};function N(e){const t=Math.max(e.width,e.height)*1.4,n=e.x+e.width/2-t/2,i=e.y+e.height/2-t/2;return{left:`${n}px`,top:`${i}px`,width:`${t}px`,height:`${t}px`,borderRadius:`${t}px`}}const E={width:1920,height:1080};function B(){return typeof window>"u"?E:{width:window.innerWidth,height:window.innerHeight}}function w(e,t){return Math.min(Math.max(e,0),t)}function v(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function P(e,t=e){const n=B(),i=v(t),o=v(e),h=Math.max(Math.abs(o.y-i.y),120),s={x:w((i.x+o.x)/2,n.width),y:w(Math.min(i.y,o.y)-h,n.height)},a=w(i.x,n.width),x=w(i.y,n.height),l=w(o.x,n.width),y=w(o.y,n.height);return`M ${a} ${x} Q ${s.x} ${s.y} ${l} ${y}`}function k(e,t){const n={left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`};return e==="circle"?{type:e,boxStyle:N(t)}:e==="arrow"?{type:e,boxStyle:n,arrowPath:P(t)}:{type:"box",boxStyle:{...n,borderRadius:"12px"}}}const A=({instruction:e,viewportWidth:t,viewportHeight:n})=>{const i=c.useMemo(()=>R(e,t,n),[e,t,n]);if(!e||!i)return null;const o=k(e.shape,i),h=L(i,t,n);return r.jsxs("div",{className:"annotation-layer",children:[o.type==="box"&&r.jsx("div",{className:"annotation-box",style:o.boxStyle}),o.type==="circle"&&r.jsx("div",{className:"annotation-circle",style:o.boxStyle}),o.type==="arrow"&&o.arrowPath&&r.jsx("svg",{className:"annotation-arrow",viewBox:`0 0 ${t} ${n}`,preserveAspectRatio:"xMidYMid meet",children:r.jsx("path",{d:o.arrowPath})}),r.jsx("div",{className:"annotation-label",style:h,children:e.label})]})};function R(e,t,n){if(!e)return null;const i=t||(typeof window<"u"?window.innerWidth:1920),o=n||(typeof window<"u"?window.innerHeight:1080),h=e.viewport?.width??i,s=e.viewport?.height??o,a=h?i/h:1,x=s?o/s:1,l=e.bboxPixels?{x:e.bboxPixels.x,y:e.bboxPixels.y,width:e.bboxPixels.width,height:e.bboxPixels.height}:e.bbox?{x:e.bbox.x*h,y:e.bbox.y*s,width:e.bbox.width*h,height:e.bbox.height*s}:null;return l?I({x:l.x*a,y:l.y*x,width:l.width*a,height:l.height*x},i,o):null}function I(e,t,n){const i=Math.min(e.width,t),o=Math.min(e.height,n);return{x:Math.min(Math.max(e.x,0),Math.max(0,t-i)),y:Math.min(Math.max(e.y,0),Math.max(0,n-o)),width:Math.max(1,i),height:Math.max(1,o)}}function L(e,t,n){const o=Math.max(0,t-220),h=Math.min(Math.max(e.x,0),o),s=Math.min(e.y+e.height+12,Math.max(0,n-60));return{left:`${h}px`,top:`${s}px`}}const C={width:typeof window<"u"?window.innerWidth:1920,height:typeof window<"u"?window.innerHeight:1080},V=()=>{const[e,t]=c.useState([]),[n,i]=c.useState(0),[o,h]=c.useState(C),s=typeof window<"u"?window.visor?.overlay:void 0,a=e[n]??null,x=c.useMemo(()=>e.slice(n),[e,n]);c.useEffect(()=>{if(typeof window>"u")return;const d=()=>{h({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),c.useEffect(()=>{if(!s)return;s.ready?.();const d=s.onStepUpdate?.(f=>{t(m=>{const b=m.findIndex(j=>j.id===f.id);let u,g;return b>=0?(u=[...m],u[b]=f,g=b):(u=[...m,f],g=u.length-1),i(g),u})}),p=s.onReset?.(()=>{t([]),i(0)});return()=>{d?.(),p?.()}},[s]);const l=c.useCallback(()=>{a&&s?.markDone?.(a.id)},[a,s]),y=c.useCallback(d=>{s?.setPointerMode?.(d)},[s]);return r.jsxs("div",{className:"overlay-shell",children:[r.jsx(A,{instruction:a,viewportWidth:o.width,viewportHeight:o.height}),r.jsxs("section",{className:"overlay-card",onMouseEnter:()=>y("interactive"),onMouseLeave:()=>y("passthrough"),children:[r.jsx("p",{className:"overlay-label",children:a?"Next step":"Waiting for instructions"}),r.jsx("h1",{className:"overlay-title",children:a?.label??"No instruction yet"}),r.jsx("p",{className:"overlay-text",children:a?.step_description??"Trigger a task from the chat window to get started."}),x.length>0&&r.jsx("ol",{className:"overlay-step-list",children:x.map((d,p)=>r.jsxs("li",{className:p===0?"overlay-step-active":"",children:[r.jsx("strong",{children:d.label}),r.jsx("span",{children:d.step_description})]},d.id))}),r.jsx(S,{onClick:l,disabled:!a,children:"Mark done"})]})]})},M=document.getElementById("root");if(!M)throw new Error("Overlay root element not found");const W=$.createRoot(M);W.render(r.jsx(V,{}));
